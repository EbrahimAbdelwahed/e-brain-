#[WO WO-20250903-009] Observability hooks: Langfuse (no-op) + enriched run_report

Status: Draft PR
Labels: feat, observability, pipeline
Reviewers: @maintainer
Auto-merge: enable on green

## Problem
Per ARCHITECT.md, the pipeline must support optional observability with Langfuse hooks and local logs, while keeping tests offline-friendly and preserving existing behavior. We also need to enrich `run_report.json` with stage counts/durations and an observability flag, ensuring backward compatibility for existing consumers.

## Approach
- Add `pipeline/obs.py`:
  - Read `LANGFUSE_HOST`, `LANGFUSE_PUBLIC_KEY`, `LANGFUSE_SECRET_KEY`.
  - Guarded import of `langfuse`; if missing or env unset -> safe no-op.
  - Expose `obs_span(name, attrs)` context manager that logs locally and attempts Langfuse spans when enabled; always safe offline.
  - Provide minimal `obs_metadata()` for run_report enrichment.
- Instrument major stages in `pipeline/__main__.py`:
  - Wrap `fetch`, `extract`, `cluster`, `summarize`, `publish`, and each section in `all` with `obs_span`, adding counts where available.
  - Enrich `run_report.json` with `observability: {enabled: bool}` and keep existing fields intact.
- Instrument LLM calls in `pipeline/summarize.py`:
  - Wrap OpenRouter call with `obs_span("llm.summarize", {model, temperature, top_p, seed, prompt_chars, output_chars})`.
- PyProject:
  - Add optional dependency extras: `observability = ["langfuse>=2,<3"]`.
- README:
  - New Observability section describing env vars, no-op behavior, span structure, and run_report enrichment.
- Tests:
  - `tests/test_obs_noop.py`: verifies `obs_span` is importable and usable with no env set (no exceptions, no network), and the summarization path remains unchanged.

## Tradeoffs
- Langfuse SDK APIs can vary; to avoid brittleness, span/trace interactions are best-effort with broad guards. When env is set and SDK present, spans are attempted; otherwise itâ€™s a strict no-op. This limits depth of emitted metadata but preserves reliability.
- Stage durations are already recorded in run_report; spans add coarse-grained timing and attributes without altering functional behavior.

## Testing & Evidence
- Offline-friendly run: `pytest -q` passes locally (all tests including the new no-op test).
- No network required: tests avoid setting Langfuse env vars; imports are guarded.
- Manual smoke: ran `python -m pipeline all` on fixtures; `run_report.json` includes `observability.enabled` and existing fields unchanged.

## Risks & Mitigations
- Accidental network calls in CI: mitigated by strict no-op when env unset and guarded SDK import.
- Runtime overhead: spans are coarse-grained around stage boundaries; logging remains lightweight.
- SDK surface drift: wrapper isolates usage; failures degrade to local logs/no-op.

## Checklists
- Code: minimal, targeted changes; style consistent with repo.
- Tests: offline no-op test added; existing suite remains green.
- Security: no secrets added; env vars only.
- Docs: README updated; behavior clearly documented.

## How to validate
- Without Langfuse: `pytest -q` (should pass offline).
- With Langfuse (optional): set `LANGFUSE_*` env vars, install extras `pip install -e .[observability]`, and run `python -m pipeline all`; check logs and Langfuse UI. `run_report.json` will include `observability.enabled=true` and may include a `trace_id`.

## Notes
- Branch: feat/WO-20250903-009-observability-langfuse
- On merge, please tag with feat/observability/pipeline and enable auto-merge on green.
- Post-merge comment: "WO WO-20250903-009: criteria met; artifacts attached. Ready."

